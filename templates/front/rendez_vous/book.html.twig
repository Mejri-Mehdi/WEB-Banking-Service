{% extends 'front/base_client.html.twig' %}

{% block body %}
<div class="mb-4">
    <nav aria-label="breadcrumb">
        <ol class="breadcrumb">
            <li class="breadcrumb-item"><a href="{{ path('client_dashboard') }}">Dashboard</a></li>
            <li class="breadcrumb-item"><a href="{{ path('client_rdv_list') }}">Mes rendez-vous</a></li>
            <li class="breadcrumb-item active">Prendre rendez-vous</li>
        </ol>
    </nav>
    <h2 style="color: var(--dark-gray); font-weight: 700;">Prendre rendez-vous</h2>
    <p style="color: var(--medium-gray);">Réservez un créneau pour visiter votre agence</p>
</div>

<div class="row justify-content-center">
    <div class="col-lg-8">
        <div class="card">
            <div class="card-body p-4">
                <form method="post">
                    <div class="mb-4">
                        <label for="service_id" class="form-label" style="font-weight: 600; color: var(--dark-gray);">
                            <i class="bi bi-briefcase text-primary me-2"></i>Service <span style="color: var(--danger);">*</span>
                        </label>
                        <select name="service_id" id="service_id" class="form-select form-select-lg" required>
                            <option value="">-- Choisissez un service --</option>
                            {% for service in services %}
                                <option value="{{ service.id }}" 
                                        data-documents="{{ service.documentsRequis|default('Aucun document requis') }}"
                                        data-frais="{{ service.frais|default('0') }}"
                                        data-duree="{{ service.dureeEstimee }}">
                                    {{ service.nomService }} ({{ service.categorie }}) - {{ service.frais ? service.frais ~ ' DT' : 'Gratuit' }}
                                </option>
                            {% endfor %}
                        </select>
                        <div id="service-details" class="mt-3 p-3 bg-light rounded d-none">
                            <h6 class="text-primary mb-2"><i class="bi bi-info-circle me-2"></i>Détails du service</h6>
                            <p class="mb-1"><strong><i class="bi bi-clock me-2"></i>Durée:</strong> <span id="detail-duree"></span> min</p>
                            <p class="mb-1"><strong><i class="bi bi-cash-coin me-2"></i>Frais:</strong> <span id="detail-frais"></span> DT</p>
                            <p class="mb-0"><strong><i class="bi bi-file-earmark-text me-2"></i>Documents requis:</strong></p>
                            <p id="detail-documents" class="text-muted small mb-0 ps-4"></p>
                        </div>
                    </div>

                    <div class="mb-4">
                        <label for="agence_id" class="form-label" style="font-weight: 600; color: var(--dark-gray);">
                            <i class="bi bi-building text-primary me-2"></i>Agence <span style="color: var(--danger);">*</span>
                        </label>
                        <select name="agence_id" id="agence_id" class="form-select form-select-lg" required>
                            <option value="">-- Choisissez une agence --</option>
                            {% for agence in agences %}
                                <option value="{{ agence.id }}">{{ agence.nomAg }} - {{ agence.adresseAg }}</option>
                            {% endfor %}
                        </select>
                    </div>

                    <div class="row mb-4">
                        <div class="col-md-6">
                            <label for="date_rdv" class="form-label" style="font-weight: 600; color: var(--dark-gray);">
                                <i class="bi bi-calendar3 text-primary me-2"></i>Date <span style="color: var(--danger);">*</span>
                            </label>
                            <input type="date" name="date_rdv" id="date_rdv" class="form-control form-control-lg" required min="{{ 'now'|date('Y-m-d') }}">
                        </div>
                        <div class="col-md-6">
                            <label for="heure_rdv" class="form-label" style="font-weight: 600; color: var(--dark-gray);">
                                <i class="bi bi-clock text-primary me-2"></i>Heure <span style="color: var(--danger);">*</span>
                            </label>
                            <select name="heure_rdv" id="heure_rdv" class="form-select form-select-lg" required>
                                <option value="">-- Choisissez une heure --</option>
                                <option value="08:00">08:00</option>
                                <option value="09:00">09:00</option>
                                <option value="10:00">10:00</option>
                                <option value="11:00">11:00</option>
                                <option value="14:00">14:00</option>
                                <option value="15:00">15:00</option>
                                <option value="16:00">16:00</option>
                                <option value="17:00">17:00</option>
                            </select>
                        </div>
                    </div>

                    <div class="alert alert-info">
                        <h6 style="color: var(--primary-blue); font-weight: 600;">
                            <i class="bi bi-info-circle me-2"></i>Informations importantes
                        </h6>
                        <ul class="mb-0" style="font-size: 0.875rem;">
                            <li>Vous recevrez un ticket de confirmation avec un QR code</li>
                            <li>Présentez le QR code à votre arrivée</li>
                            <li>Arrivez 10 minutes avant l'heure prévue</li>
                        </ul>
                    </div>

                    <div class="d-grid gap-2">
                        <button type="submit" class="btn btn-primary btn-lg">
                            <i class="bi bi-check-circle me-2"></i>Confirmer le rendez-vous
                        </button>
                        <a href="{{ path('client_dashboard') }}" class="btn btn-outline-secondary">
                            <i class="bi bi-arrow-left me-2"></i>Retour
                        </a>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        const serviceSelect = document.getElementById('service_id');
        const detailsDiv = document.getElementById('service-details');
        const dureeSpan = document.getElementById('detail-duree');
        const fraisSpan = document.getElementById('detail-frais');
        const docsSpan = document.getElementById('detail-documents');

        serviceSelect.addEventListener('change', function() {
            const selectedOption = this.options[this.selectedIndex];
            
            if (selectedOption.value) {
                const duree = selectedOption.getAttribute('data-duree');
                const frais = selectedOption.getAttribute('data-frais');
                const docs = selectedOption.getAttribute('data-documents');

                dureeSpan.textContent = duree;
                fraisSpan.textContent = frais;
                docsSpan.textContent = docs;
                
                detailsDiv.classList.remove('d-none');
            } else {
                detailsDiv.classList.add('d-none');
            }
        });
    });
</script>
{% endblock %}
